const db = require("../db")

const getquiz = async(req,res,next)=>{
    try {   
         const uid = res.locals.Jwt.UserId
         const lid = req.body.lesson_id
         
    if (!lid) return res.status(400).json({
        msg: "Please pass the lesson_Id"
    })
        const sql = `select * from test where lesson_id = ? `
        const value = [lid]
        const [rows] = await db.query(sql,value)
       
                return res.status(200).json({
                  status:true,
                  data:rows,
                  msg:"this is quiz"
                })

    } catch (error) {
        console.log(error);
        return res.status(400).json({
            status:false,
            data:[],
            msg : "something went wrong"
        })       
    }
}




// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//
// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//


const GetAllQuiz = async(req,res,next)=>{

    try {

        const uid =  res.locals.Jwt.UserId
        const sql = ` select question1, anwser1, anwser2, anwser3, right_anwser from test join quiz_list on test.id = quiz_list.quiz_id `

        const value = [uid]

        const [rows] = await db.query(sql,value)
       
                return res.status(200).json({
                    status:true,
                    data:rows,
                    msg:"this is a question"
                })

    } catch (error) {
        console.log(error);
        return res.status(400).json({
            status:false,
            data:[],
            msg: "something went wrong"
        })
    }
}




// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//
// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//




const Checkanwser = async(req,res,next)=>{
    try {
       const uid = res.locals.Jwt.UserId
   
       
       const id = req.body.id
   
       if(!id) return res.status(400).json({
           msg: "Please pass tha correct id "
       })
   
       const Anwser = req.body.right_anwser
   
       if (!Anwser) return res.status(400).json({
           msg: "Please pass the Anwser"
       })        
     
   
       const sql = `select * from quiz_list where id = ? AND right_anwser = ? `
       const value = [id,Anwser]
       const [result2] = await db.query(sql,value)
        
      
           if(!result2.length > 0){
               res.status(400).json({
                   status:false,
                   data:[],
                   msg:" this is incorrect awnser "
               })
           }else{
           return res.status(200).json({
                   status:true,
                   data:result2,
                   msg:" this is correct anwser"
               })
           }

    } catch (error) {
      console.log(error); 
      return res.status(400).json({
        status:false,
        data:[],
        msg: "something went wrong"
      })   
    }
   }
   


    
    module.exports = {getquiz,GetAllQuiz,Checkanwser}