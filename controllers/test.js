const db =  require("../db")
const moment = require("moment")
const TestApi = async(req,res,next)=>{
    try {
       const uid = res.locals.Jwt.UserId
      console.log(uid,"uid");
      const sql = `select * from payment  where user_id = ? `
      const value = [uid]
      const [Rows] = await db.query(sql, value)

     console.log(Rows,"Rows");
      return res.status(200).json({
        status:true,
        data:Rows,
        msg:" YE PAYMENT HAI ! "
    })

    } catch (error) {
        console.log(error);
       return res.status(400).json({
            status:false,
            data:[],
            msg:"something error"
          })
    }
}



  // ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//
// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//


const addpayment = async(req , res , next )=>{
  try {
    const uid = res.locals.Jwt.UserId
    console.log(uid,"uid");
        const amount = req.body.amount
        const payment_method = req.body.payment_method
        const status = req.body.status
        const currentDate = moment().format(`YYYY-MM-DD`)
        console.log(currentDate,"currentdate");
        

    const sql = `INSERT INTO payment (user_id, amount, payment_method, status, create_at, update_at) values (?, ?, ?, ?, ?, ?)`
    const value = [uid,amount,payment_method,status,currentDate,currentDate]
   
    const [rows] = await db.query(sql, value)
     
    return res.status(200).json({
      status:true,
      data:[], 
      msg:"this is payment !"
  })
    
  } catch (error) {
    console.log(error);
    return res.status(400).json({
      status:false,
      data:[],
      msg: 'somthing went wrong'
    })
    
  }
}



  // ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//
// ==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================//




module.exports = {TestApi, addpayment}